<!DOCTYPE html>
<html lang="en">
<head>
  <title>Our simple HTTP server</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
  <!-- Custom CSS -->
  <link rel="stylesheet" type="text/css" href="/style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
  <script type="text/babel">
    const handleResponse = (xhr, parseResponse) => {
      const content = document.querySelector('#content');

      // Get references to the status and message fields
      const responseStatus = document.querySelector('#response-status');
      const responseMessage = document.querySelector('#response-message');

      switch(xhr.status) {
        case 200:
          
          break;
        case 201:
          
          break;
        case 204:
          
          break;
        case 400:
          
          break;
        case 404:
          
          break;
        default:
          
          break;
      }

      if(parseResponse) {
        const obj = JSON.parse(xhr.response);
        console.dir(obj);

        responseMessage.textContent = xhr.response;
      } else {
        responseMessage.textContent = "Meta Data Received";
      }
    };

    const requestUpdate = (e, userForm) => {
      const url = userForm.querySelector('#urlField').value;
      const method = userForm.querySelector('#methodSelect').value;

      const xhr = new XMLHttpRequest();
      xhr.open(method, url);

      xhr.setRequestHeader('Accept', 'application/json');

      if(method === 'head') {
        xhr.onload = () => handleResponse(xhr, false);  
      } else {
        xhr.onload = () => handleResponse(xhr, true);
      }

      xhr.send();

      e.preventDefault();
      return false;
    };

    const sendPost = (e, newTaskForm) => {
        e.preventDefault();

        const nameAction = newTaskForm.getAttribute('action');
        const nameMethod = newTaskForm.getAttribute('method');

        const nameField = newTaskForm.querySelector('#nameField');
        const ageField = newTaskForm.querySelector('#ageField');

        const xhr = new XMLHttpRequest();
        xhr.open(nameMethod, nameAction);

        xhr.setRequestHeader('Accept', 'application/json');
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

        xhr.onload = () => handleResponse(xhr);

        const formData = `name=${nameField.value}&age=${ageField.value}`;
        xhr.send(formData);

        return false;
    };

    const init = () => {
      // Set up the Add User button to send a POST request
      const newTaskForm = document.querySelector('#newTaskForm');
      const addTask = (e) => sendPost(e, newTaskForm);
      newTaskForm.addEventListener('submit', addTask);

      // Set up the Get User button to send a request
      const getTasksForm = document.querySelector('#getTasksForm');
      const getTasks = (e) => requestUpdate(e, getTasksForm);
      getTasksForm.addEventListener('submit', getTasks);
    };

    window.onload = init;
  </script>
</head>
<body>
  <section id="top">
    <h3>Add New Task</h3>
    <form id="newTaskForm" action="/addTask" method="post"> <!-- TODO: POST /addTask -->
      <label for="class">Class</label>
      <input id="classField" type="text" name="class" />
      <label for="name">Name</label>
      <input id="nameField" type="text" name="name" />
      <label for="time">Estimated Time</label>
      <input id="timeField" type="text" name="time" placeholder="hh:mm"/>
      <label for="link">Link</label>
      <input id="linkField" type="text" name="link"/>
      <label for="notes">Notes</label>
      <input id="notesField" type="text" name="notes"/>
      <input type="submit" value="Add Task" />
    </form>
    <form id="getTasksForm" action="/getTasks" method="get">
      <!-- <select id='urlField'>
        <option value='/getUsers'>/getUsers</option>
        <option value='/notReal'>/notReal</option>
      </select>
      <select id="methodSelect">
        <option value="get">GET</option>
        <option value="head">HEAD</option>
      </select> -->
      <input type="submit" value="Get Tasks" />
    </form>
  </section>
  <section id="content">
    <h1 id="response-status"></h1>
    <p id="response-message"></p>
  </section>

  <table class="table">
    <thead>
      <tr>
        <td></td>
        <td>Task #</td>
        <td>Class</td>
        <td>Name</td>
        <td>Est. Time</td>
        <td>Notes</td>
      </tr>
    </thead>
    <tbody>
      <tr class="done">
        <td><input type="checkbox" checked></td>
        <td>1</td>
        <td>IGME-430</td>
        <td><a href="https://mycourses.rit.edu/d2l/le/content/885922/viewContent/7226627/View">Week 1.1 - Course Overview</a></td>
        <td>0h 28m</td>
        <td></td>
      </tr>
    </tbody>
  </table>
</body>
</html>
<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>